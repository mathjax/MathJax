(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{AbstractRegion:()=>R,DummyRegion:()=>k,HoverRegion:()=>I,LiveRegion:()=>O,SpeechRegion:()=>L,StringRegion:()=>C,ToolTip:()=>N});var i={};t.r(i),t.d(i,{AbstractExplorer:()=>P});var s={};t.r(s),t.d(s,{SpeechExplorer:()=>J});var o={};t.r(o),t.d(o,{AbstractMouseExplorer:()=>U,ContentHoverer:()=>q,FlameHoverer:()=>F,Hoverer:()=>j,ValueHoverer:()=>B});var r={};t.r(r),t.d(r,{AbstractTreeExplorer:()=>X,FlameColorer:()=>V,TreeColorer:()=>K});var n={};t.r(n),t.d(n,{ExplorerPool:()=>Y,RegionPool:()=>$});var h={};t.r(h),t.d(h,{ExplorerHandler:()=>Z,ExplorerMathDocumentMixin:()=>W,ExplorerMathItemMixin:()=>Q,setA11yOption:()=>et,setA11yOptions:()=>tt});const a=("undefined"!=typeof window?window:global).MathJax._.components.global,l=(a.GLOBAL,a.isObject,a.combineConfig,a.combineDefaults,a.combineWithMathJax),c=(a.MathJax,MathJax._.core.MathItem),d=(c.protoItem,c.AbstractMathItem,c.STATE),u=c.newState,p=MathJax._.a11y["semantic-enrich"],g=(p.enrichVisitor,p.EnrichedMathItemMixin,p.EnrichedMathDocumentMixin,p.EnrichHandler),m=MathJax._.util.Options,b=(m.isObject,m.APPEND,m.REMOVE,m.OPTIONS,m.Expandable,m.expandable),v=(m.makeArray,m.keys,m.copy,m.insert,m.defaultOptions,m.userOptions,m.selectOptions,m.selectOptionsFromKeys,m.separateOptions,m.lookup,MathJax._.core.MmlTree.SerializedMmlVisitor),y=(v.toEntity,v.SerializedMmlVisitor),f=MathJax._.util.StyleList.CssStyles,x=MathJax._.a11y.sre,S=x.Sre,A=(x.sreReady,x.default,MathJax._.a11y.speech.SpeechUtil),w=(A.ssmlParsing,A.buildLabel,A.buildSpeech),E=A.honk,M=A.InPlace;class R{constructor(t){this.document=t,this.CLASS=this.constructor,this.AddStyles(),this.AddElement()}AddStyles(){if(this.CLASS.styleAdded)return;let t=this.document.adaptor.node("style");t.innerHTML=this.CLASS.style.cssText,this.document.adaptor.head(this.document.adaptor.document).appendChild(t),this.CLASS.styleAdded=!0}AddElement(){let t=this.document.adaptor.node("div");t.classList.add(this.CLASS.className),t.style.backgroundColor="white",this.div=t,this.inner=this.document.adaptor.node("div"),this.div.appendChild(this.inner),this.document.adaptor.body(this.document.adaptor.document).appendChild(this.div)}Show(t,e){this.position(t),this.highlight(e),this.div.classList.add(this.CLASS.className+"_Show")}Hide(){this.div.classList.remove(this.CLASS.className+"_Show")}stackRegions(t){const e=t.getBoundingClientRect();let i=0,s=Number.POSITIVE_INFINITY,o=this.document.adaptor.document.getElementsByClassName(this.CLASS.className+"_Show");for(let t,e=0;t=o[e];e++)t!==this.div&&(i=Math.max(t.getBoundingClientRect().bottom,i),s=Math.min(t.getBoundingClientRect().left,s));const r=(i||e.bottom+10)+window.scrollY,n=(s<Number.POSITIVE_INFINITY?s:e.left)+window.scrollX;this.div.style.top=r+"px",this.div.style.left=n+"px"}}R.styleAdded=!1;class k extends R{Clear(){}Update(){}Hide(){}Show(){}AddElement(){}AddStyles(){}position(){}highlight(t){}}class C extends R{Clear(){this.Update(""),this.inner.style.top="",this.inner.style.backgroundColor=""}Update(t){this.inner.textContent="",this.inner.textContent=t}position(t){this.stackRegions(t)}highlight(t){const e=t.colorString();this.inner.style.backgroundColor=e.background,this.inner.style.color=e.foreground}}class N extends C{}N.className="MJX_ToolTip",N.style=new f({["."+N.className]:{display:"none"},["."+N.className+"_Show"]:{width:"auto",height:"auto",opacity:1,"text-align":"center","border-radius":"6px",padding:0,"border-bottom":"1px dotted black",position:"absolute",display:"inline-block","z-index":202}});class O extends C{}O.className="MJX_LiveRegion",O.style=new f({["."+O.className]:{display:"none"},["."+O.className+"_Show"]:{position:"absolute",top:0,display:"block",width:"auto",height:"auto",padding:0,opacity:1,"z-index":"202",left:0,right:0,margin:"0 auto","background-color":"rgba(0, 0, 255, 0.2)","box-shadow":"0px 5px 20px #888",border:"2px solid #CCCCCC"}});class L extends O{constructor(){super(...arguments),this.active=!1,this.node=null,this.clear=!1,this.highlighter=S.getHighlighter({color:"red"},{color:"black"},{renderer:this.document.outputJax.name,browser:"v3"}),this.voiceRequest=!1}Show(t,e){this.node=t,super.Show(t,e)}Update(t){if(this.voiceRequest)return void this.makeVoice(t);speechSynthesis.onvoiceschanged=(()=>this.voiceRequest=!0).bind(this),super.Update("\xa0");new Promise((t=>{setTimeout((()=>{this.voiceRequest?t(!0):setTimeout((()=>{this.voiceRequest=!0,t(!0)}),100)}),100)})).then((()=>this.makeVoice(t)))}makeVoice(t){this.active=this.document.options.a11y.voicing&&!!speechSynthesis.getVoices().length,speechSynthesis.cancel(),this.clear=!0;let[e,i]=w(t,this.document.options.sre.locale,this.document.options.sre.rate);super.Update(e),this.active&&e&&this.makeUtterances(i,this.document.options.sre.locale)}makeUtterances(t,e){let i=null;for(let s of t)if(s.mark){if(!i){this.highlightNode(s.mark,!0);continue}i.addEventListener("end",(t=>{this.highlightNode(s.mark)}))}else if(s.pause){let t=parseInt(s.pause.match(/^[0-9]+/)[0]);if(isNaN(t)||!i)continue;i.addEventListener("end",(e=>{speechSynthesis.pause(),setTimeout((()=>{speechSynthesis.resume()}),t)}))}else i=new SpeechSynthesisUtterance(s.text),s.rate&&(i.rate=s.rate),s.pitch&&(i.pitch=s.pitch),i.lang=e,speechSynthesis.speak(i);i&&i.addEventListener("end",(t=>{this.highlighter.unhighlight()}))}highlightNode(t,e=!1){this.highlighter.unhighlight();let i=Array.from(this.node.querySelectorAll(`[data-semantic-id="${t}"]`));this.clear&&!e||this.highlighter.highlight(i),this.clear=!1}}class I extends R{constructor(t){super(t),this.document=t,this.inner.style.lineHeight="0"}position(t){const e=t.getBoundingClientRect(),i=this.div.getBoundingClientRect();let s,o=e.left+e.width/2-i.width/2;switch(o=o<0?0:o,o+=window.scrollX,this.document.options.a11y.align){case"top":s=e.top-i.height-10;break;case"bottom":s=e.bottom+10;break;default:s=e.top+e.height/2-i.height/2}s+=window.scrollY,s=s<0?0:s,this.div.style.top=s+"px",this.div.style.left=o+"px"}highlight(t){if(this.inner.firstChild&&!this.inner.firstChild.hasAttribute("sre-highlight"))return;const e=t.colorString();this.inner.style.backgroundColor=e.background,this.inner.style.color=e.foreground}Show(t,e){this.div.style.fontSize=this.document.options.a11y.magnify,this.Update(t),super.Show(t,e)}Clear(){this.inner.textContent="",this.inner.style.top="",this.inner.style.backgroundColor=""}Update(t){this.Clear();let e=this.cloneNode(t);this.inner.appendChild(e)}cloneNode(t){let e=t.cloneNode(!0);if("MJX-CONTAINER"!==e.nodeName){"g"!==e.nodeName&&(e.style.marginLeft=e.style.marginRight="0");let i=t;for(;i&&"MJX-CONTAINER"!==i.nodeName;)i=i.parentNode;if("MJX-MATH"!==e.nodeName&&"svg"!==e.nodeName){if(e=i.firstChild.cloneNode(!1).appendChild(e).parentNode,"svg"===e.nodeName){e.firstChild.setAttribute("transform","matrix(1 0 0 -1 0 0)");const s=parseFloat(e.getAttribute("viewBox").split(/ /)[2]),o=parseFloat(e.getAttribute("width")),{x:r,y:n,width:h,height:a}=t.getBBox();e.setAttribute("viewBox",[r,-(n+a),h,a].join(" ")),e.removeAttribute("style"),e.setAttribute("width",o/s*h+"ex"),e.setAttribute("height",o/s*a+"ex"),i.setAttribute("sre-highlight","false")}}e=i.cloneNode(!1).appendChild(e).parentNode,e.style.margin="0"}return e}}I.className="MJX_HoverRegion",I.style=new f({["."+I.className]:{display:"none"},["."+I.className+"_Show"]:{display:"block",position:"absolute",width:"max-content",height:"auto",padding:0,opacity:1,"z-index":"202",margin:"0 auto","background-color":"rgba(0, 0, 255, 0.2)","box-shadow":"0px 10px 20px #888",border:"2px solid #CCCCCC"}});class P{get highlighter(){return this.pool.highlighter}static stopEvent(t){t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopImmediatePropagation?t.stopImmediatePropagation():t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0}static create(t,e,i,s,...o){return new this(t,e,i,s,...o)}constructor(t,e,i,s,...o){this.document=t,this.pool=e,this.region=i,this.node=s,this.stoppable=!0,this.events=[],this._active=!1}Events(){return this.events}get active(){return this._active}set active(t){this._active=t}Attach(){this.AddEvents()}Detach(){this.RemoveEvents()}Start(){this.active=!0}Stop(){this.active&&(this.region.Clear(),this.region.Hide(),this.active=!1)}AddEvents(){for(let[t,e]of this.events)this.node.addEventListener(t,e)}RemoveEvents(){for(let[t,e]of this.events)this.node.removeEventListener(t,e)}Update(t=!1){}stopEvent(t){this.stoppable&&P.stopEvent(t)}}const T=["tree","group","treeitem"],_=T.map((t=>`[role="${t}"]`)).join(","),H=T.map((t=>`[tabindex="0"][role="${t}"]`)).join(",");function D(t){return t.matches("mjx-container")}class J extends P{get generators(){var t;return null===(t=this.item)||void 0===t?void 0:t.generatorPool}MouseDown(t){this.mousedown=!0,t.preventDefault()}Click(t){const e=t.target.closest(_);if(this.node.contains(e)||(this.mousedown=!1),this.node.contains(e)){const i=this.node.querySelector(H);i&&(i.removeAttribute("tabindex"),this.FocusOut(null)),this.current=e,this.triggerLinkMouse()||this.Start(),t.preventDefault()}}FocusIn(t){this.mousedown?this.mousedown=!1:(this.current=this.current||this.node.querySelector('[role="treeitem"]'),this.Start(),t.preventDefault())}FocusOut(t){var e;this.active&&(this.generators.CleanUp(this.current),this.move||this.Stop(),null===(e=this.current)||void 0===e||e.removeAttribute("tabindex"),this.node.setAttribute("tabindex","0"))}Attach(){super.Attach(),this.attached=!0,this.oldIndex=this.node.tabIndex,this.node.tabIndex=0}AddEvents(){this.eventsAttached||(super.AddEvents(),this.eventsAttached=!0)}Detach(){this.active&&(this.node.tabIndex=this.oldIndex,this.oldIndex=null,this.node.removeAttribute("role")),this.attached=!1}nextSibling(t){const e=t.nextElementSibling;if(e){if(e.matches(_))return e;const t=e.querySelector(_);return null!=t?t:this.nextSibling(e)}return D(t)||t.parentElement.matches(_)?null:this.nextSibling(t.parentElement)}prevSibling(t){const e=t.previousElementSibling;if(e){if(e.matches(_))return e;const t=e.querySelector(_);return null!=t?t:this.prevSibling(e)}return D(t)||t.parentElement.matches(_)?null:this.prevSibling(t.parentElement)}actionable(t){const e=null==t?void 0:t.parentNode;return e&&this.highlighter.isMactionNode(e)?e:null}depth(t){return this.generators.depth(t,!!this.actionable(t)),this.refocus(t),this.generators.lastMove=M.DEPTH,t}expand(t){const e=this.actionable(t);return e?(e.dispatchEvent(new Event("click")),t):null}summary(t){return this.generators.summary(t),this.refocus(t),this.generators.lastMove=M.SUMMARY,t}nextRules(t){return this.generators.nextRules(t),this.Speech(),this.refocus(t),t}nextStyle(t){return this.generators.nextStyle(t),this.Speech(),this.refocus(t),t}refocus(t){t.blur(),t.focus()}Move(t){this.move=!0;const e=t.target,i=this.moves.get(t.key);let s=null;return i&&(t.preventDefault(),s=i(e)),s?(e.removeAttribute("tabindex"),s.setAttribute("tabindex","0"),s.focus(),this.current=s,this.move=!1,!0):(this.move=!1,!1)}NoMove(){E()}constructor(t,e,i,s,o,r,n,h){super(t,e,null,s),this.document=t,this.pool=e,this.region=i,this.node=s,this.brailleRegion=o,this.magnifyRegion=r,this.item=h,this.attached=!1,this.sound=!1,this.restarted=null,this.oldIndex=null,this.current=null,this.eventsAttached=!1,this.move=!1,this.mousedown=!1,this.events=super.Events().concat([["keydown",this.KeyDown.bind(this)],["mousedown",this.MouseDown.bind(this)],["click",this.Click.bind(this)],["focusin",this.FocusIn.bind(this)],["focusout",this.FocusOut.bind(this)]]),this.moves=new Map([["ArrowDown",t=>t.querySelector(_)],["ArrowUp",t=>t.parentElement.closest(_)],["ArrowLeft",this.prevSibling.bind(this)],["ArrowRight",this.nextSibling.bind(this)],[">",this.nextRules.bind(this)],["<",this.nextStyle.bind(this)],["x",this.summary.bind(this)],["Enter",this.expand.bind(this)],["d",this.depth.bind(this)]])}Start(){if(!this.attached)return;if(this.node.hasAttribute("tabindex")&&this.node.removeAttribute("tabindex"),this.active)return;if(null!==this.restarted){if(this.current=this.node.querySelector(`[data-semantic-id="${this.restarted}"]`),!this.current){const t=Array.from(this.node.querySelectorAll('[data-semantic-type="dummy"]')).map((t=>t.getAttribute("data-semantic-id")));let e=this.generators.element.querySelector(`[data-semantic-id="${this.restarted}"]`);for(;e&&e!==this.generators.element;){let i=e.getAttribute("data-semantic-id");if(-1!==t.indexOf(i)){this.current=this.node.querySelector(`[data-semantic-id="${i}"]`);break}e=e.parentNode}}this.restarted=null}this.current||(this.current=this.node.childNodes[0]);const t=this.document.options;let e=S.sreReady();this.generators.update(t)&&(e=e.then((()=>this.Speech()))),this.current.setAttribute("tabindex","0"),this.current.focus(),super.Start(),t.a11y.subtitles&&t.a11y.speech&&t.enableSpeech&&e.then((()=>this.region.Show(this.node,this.highlighter))),t.a11y.viewBraille&&t.a11y.braille&&t.enableBraille&&e.then((()=>this.brailleRegion.Show(this.node,this.highlighter))),t.a11y.keyMagnifier&&this.magnifyRegion.Show(this.node,this.highlighter),this.Update()}Update(t=!1){(this.active||t)&&(this.pool.unhighlight(),this.pool.highlight([this.current]),this.region.node=this.node,this.generators.updateRegions(this.current,this.region,this.brailleRegion),this.magnifyRegion.Update(this.current))}Speech(){this.item.outputData.speech=this.generators.updateSpeech(this.item.typesetRoot)}KeyDown(t){const e=t.key;if("Tab"!==e&&" "!==e)if("Control"!==e){if("Escape"===e)return this.Stop(),void this.stopEvent(t);if("Enter"===e){if(!this.active&&t.target instanceof HTMLAnchorElement)return t.target.dispatchEvent(new MouseEvent("click")),void this.stopEvent(t);if(this.active&&this.triggerLinkKeyboard(t))return this.Stop(),void this.stopEvent(t);if(!this.active)return this.current||(this.current=this.node.querySelector('[role="treeitem"]')),this.Start(),void this.stopEvent(t)}if(this.active){if(this.Move(t))return this.stopEvent(t),void this.Update();if(t.getModifierState(e))return;this.sound&&this.NoMove()}}else speechSynthesis.cancel()}triggerLinkKeyboard(t){return"Enter"===t.code&&(this.current?this.triggerLink(this.current):t.target instanceof HTMLAnchorElement&&(t.target.dispatchEvent(new MouseEvent("click")),!0))}triggerLink(t){var e;return!!(null===(e=null==t?void 0:t.getAttribute("data-semantic-postfix"))||void 0===e?void 0:e.match(/(^| )link($| )/))&&(t.parentNode.dispatchEvent(new MouseEvent("click")),!0)}triggerLinkMouse(){let t=this.current;for(;t&&t!==this.node;){if(this.triggerLink(t))return!0;t=t.parentNode}return!1}Stop(){this.active&&(this.pool.unhighlight(),this.magnifyRegion.Hide(),this.region.Hide(),this.brailleRegion.Hide()),super.Stop()}semanticFocus(){var t;const e=(this.current||this.node).getAttribute("data-semantic-id"),i=null===(t=this.generators.speechGenerator.getRebuilt())||void 0===t?void 0:t.stree;if(!i)return null;return i.root.querySelectorAll((t=>t.id.toString()===e))[0]||i.root}}class U extends P{constructor(){super(...arguments),this.events=super.Events().concat([["mouseover",this.MouseOver.bind(this)],["mouseout",this.MouseOut.bind(this)]])}MouseOver(t){this.Start()}MouseOut(t){this.Stop()}}class j extends U{constructor(t,e,i,s,o,r){super(t,e,i,s),this.document=t,this.pool=e,this.region=i,this.node=s,this.nodeQuery=o,this.nodeAccess=r}MouseOut(t){t.clientX===this.coord[0]&&t.clientY===this.coord[1]||(this.highlighter.unhighlight(),this.region.Hide(),super.MouseOut(t))}MouseOver(t){super.MouseOver(t);let e=t.target;this.coord=[t.clientX,t.clientY];let[i,s]=this.getNode(e);i&&(this.highlighter.unhighlight(),this.highlighter.highlight([i]),this.region.Update(s),this.region.Show(i,this.highlighter))}getNode(t){let e=t;for(;t&&t!==this.node;){if(this.nodeQuery(t))return[t,this.nodeAccess(t)];t=t.parentNode}for(t=e;t;){if(this.nodeQuery(t))return[t,this.nodeAccess(t)];let e=t.childNodes[0];t=e&&"defs"===e.tagName?t.childNodes[1]:e}return[null,null]}}class B extends j{}class q extends j{}class F extends j{constructor(t,e,i,s){super(t,e,new k(t),s,(t=>this.highlighter.isMactionNode(t)),(()=>{})),this.document=t,this.pool=e,this.node=s}}class X extends P{constructor(t,e,i,s,o){super(t,e,null,s),this.document=t,this.pool=e,this.region=i,this.node=s,this.mml=o,this.stoppable=!1}Attach(){super.Attach(),this.Start()}Detach(){this.Stop(),super.Detach()}}class V extends X{Start(){this.active||(this.active=!0,this.highlighter.highlightAll(this.node))}Stop(){this.active&&this.highlighter.unhighlightAll(),this.active=!1}}class K extends X{Start(){if(this.active)return;this.active=!0;let t=S.getSpeechGenerator("Color");this.node.hasAttribute("hasforegroundcolor")||(t.generateSpeech(this.node,this.mml),this.node.setAttribute("hasforegroundcolor","true")),this.highlighter.colorizeAll(this.node)}Stop(){this.active&&this.highlighter.uncolorizeAll(this.node),this.active=!1}}class ${constructor(t){this.document=t,this.speechRegion=new L(this.document),this.brailleRegion=new O(this.document),this.magnifier=new I(this.document),this.tooltip1=new N(this.document),this.tooltip2=new N(this.document),this.tooltip3=new N(this.document)}}let z={speech:(t,e,i,...s)=>{let o=J.create(t,e,t.explorerRegions.speechRegion,i,t.explorerRegions.brailleRegion,t.explorerRegions.magnifier,s[0],s[1]);return o.sound=!0,o},mouseMagnifier:(t,e,i,...s)=>q.create(t,e,t.explorerRegions.magnifier,i,(t=>t.hasAttribute("data-semantic-type")),(t=>t)),hover:(t,e,i,...s)=>F.create(t,e,null,i),infoType:(t,e,i,...s)=>B.create(t,e,t.explorerRegions.tooltip1,i,(t=>t.hasAttribute("data-semantic-type")),(t=>t.getAttribute("data-semantic-type"))),infoRole:(t,e,i,...s)=>B.create(t,e,t.explorerRegions.tooltip2,i,(t=>t.hasAttribute("data-semantic-role")),(t=>t.getAttribute("data-semantic-role"))),infoPrefix:(t,e,i,...s)=>B.create(t,e,t.explorerRegions.tooltip3,i,(t=>t.hasAttribute("data-semantic-prefix")),(t=>t.getAttribute("data-semantic-prefix"))),flame:(t,e,i,...s)=>V.create(t,e,null,i),treeColoring:(t,e,i,...s)=>K.create(t,e,null,i,...s)};class Y{constructor(){this.explorers={},this.attached=[],this._restart=[],this.speechExplorerKeys=["speech","braille","keyMagnifier"]}get highlighter(){if(this._renderer!==this.document.outputJax.name)return this._renderer=this.document.outputJax.name,this.setPrimaryHighlighter(),this._highlighter;let[t,e]=this.colorOptions();return S.updateHighlighter(e,t,this._highlighter),this._highlighter}init(t,e,i,s){this.document=t,this.mml=i,this.node=e,this.setPrimaryHighlighter();for(let t of Object.keys(z))this.explorers[t]=z[t](this.document,this,this.node,this.mml,s);this.setSecondaryHighlighter(),this.attach()}attach(){this.attached=[];let t=[];const e=this.document.options.a11y;for(let[i,s]of Object.entries(this.explorers))s instanceof J?(s.AddEvents(),s.stoppable=!1,t.unshift(s),this.speechExplorerKeys.some((t=>this.document.options.a11y[t]))?(s.Attach(),this.attached.push(i)):s.Detach()):e[i]||"speech"===i&&(e.braille||e.keyMagnifier)?(s.Attach(),this.attached.push(i)):s.Detach();for(let e of t)if(e.attached){e.stoppable=!0;break}}reattach(){for(let t of this.attached){let e=this.explorers[t];e.active&&(this._restart.push(t),e.Stop())}}restart(){this._restart.forEach((t=>{this.explorers[t].Start()})),this._restart=[]}setPrimaryHighlighter(){let[t,e]=this.colorOptions();this._highlighter=S.getHighlighter(e,t,{renderer:this.document.outputJax.name,browser:"v3"})}setSecondaryHighlighter(){this.secondaryHighlighter=S.getHighlighter({color:"red"},{color:"black"},{renderer:this.document.outputJax.name,browser:"v3"}),this.speech.region.highlighter=this.secondaryHighlighter}highlight(t){this.highlighter.highlight(t)}unhighlight(){this.secondaryHighlighter.unhighlight(),this.highlighter.unhighlight()}get speech(){return this.explorers.speech}colorOptions(){let t=this.document.options.a11y;return[{color:t.foregroundColor.toLowerCase(),alpha:t.foregroundOpacity/100},{color:t.backgroundColor.toLowerCase(),alpha:t.backgroundOpacity/100}]}}const G="undefined"!=typeof window;function Q(t,e){return class extends t{constructor(){super(...arguments),this.refocus=null}explorable(t,i=!1){if(!(this.state()>=d.EXPLORER)){if(!this.isEscaped&&(t.options.enableExplorer||i)){const i=this.typesetRoot,s=e(this.root);this.explorers||(this.explorers=new Y),this.explorers.init(t,i,s,this)}this.state(d.EXPLORER)}}rerender(t,e=d.RERENDER){if(this.explorers){let t=this.explorers.speech;if(t&&t.attached&&t.active){const e=t.semanticFocus();this.refocus=e?e.id:null}this.explorers.reattach()}super.rerender(t,e)}updateDocument(t){var e;super.updateDocument(t),(null===(e=this.explorers)||void 0===e?void 0:e.speech)&&(this.explorers.speech.restarted=this.refocus),this.refocus=null,this.explorers&&this.explorers.restart()}}}function W(t){var e;return(e=class extends t{constructor(...t){super(...t),this.explorerRegions=null;const e=this.constructor.ProcessBits;e.has("explorer")||e.allocate("explorer");const i=new y(this.mmlFactory),s=this.options;s.a11y.speechRules||(s.a11y.speechRules=`${s.sre.domain}-${s.sre.style}`),s.MathItem=Q(s.MathItem,(t=>i.visitTree(t)))}explorable(){if(!this.processed.isSet("explorer")){if(this.options.enableExplorer){this.explorerRegions||(this.explorerRegions=new $(this));for(const t of this.math)t.explorable(this)}this.processed.set("explorer")}return this}state(t,e=!1){return super.state(t,e),t<d.EXPLORER&&this.processed.clear("explorer"),this}}).OPTIONS=Object.assign(Object.assign({},t.OPTIONS),{enableExplorer:G,renderActions:b(Object.assign(Object.assign({},t.OPTIONS.renderActions),{explorable:[d.EXPLORER]})),sre:b(Object.assign(Object.assign({},t.OPTIONS.sre),{speech:"none",structure:!0,aria:!0})),a11y:Object.assign(Object.assign({},t.OPTIONS.a11y),{align:"top",backgroundColor:"Blue",backgroundOpacity:20,flame:!1,foregroundColor:"Black",foregroundOpacity:100,highlight:"None",hover:!1,infoPrefix:!1,infoRole:!1,infoType:!1,keyMagnifier:!1,magnification:"None",magnify:"400%",mouseMagnifier:!1,subtitles:!0,treeColoring:!1,viewBraille:!0,voicing:!1})}),e}function Z(t,e=null){return!t.documentClass.prototype.enrich&&e&&(t=g(t,e)),t.documentClass=W(t.documentClass),t}function tt(t,e){var i;let s=S.engineSetup();for(let i in e)void 0!==t.options.a11y[i]?et(t,i,e[i]):void 0!==s[i]&&(t.options.sre[i]=e[i]);for(let e of t.math)null===(i=null==e?void 0:e.explorers)||void 0===i||i.attach()}function et(t,e,i){switch(e){case"speechRules":const[s,o]=i.split("-");t.options.sre.domain=s,t.options.sre.style=o;break;case"magnification":switch(i){case"None":t.options.a11y.magnification=i,t.options.a11y.keyMagnifier=!1,t.options.a11y.mouseMagnifier=!1;break;case"Keyboard":t.options.a11y.magnification=i,t.options.a11y.keyMagnifier=!0,t.options.a11y.mouseMagnifier=!1;break;case"Mouse":t.options.a11y.magnification=i,t.options.a11y.keyMagnifier=!1,t.options.a11y.mouseMagnifier=!0}break;case"highlight":switch(i){case"None":t.options.a11y.highlight=i,t.options.a11y.hover=!1,t.options.a11y.flame=!1;break;case"Hover":t.options.a11y.highlight=i,t.options.a11y.hover=!0,t.options.a11y.flame=!1;break;case"Flame":t.options.a11y.highlight=i,t.options.a11y.hover=!1,t.options.a11y.flame=!0}break;case"locale":t.options.sre.locale=i;break;default:t.options.a11y[e]=i}}u("EXPLORER",160),MathJax.loader&&MathJax.loader.checkVersion("a11y/explorer","4.0.0-beta.6","a11y"),l({_:{a11y:{explorer_ts:h,explorer:{Explorer:i,ExplorerPool:n,KeyExplorer:s,MouseExplorer:o,Region:e,TreeExplorer:r}}}}),MathJax.startup&&"undefined"!=typeof window&&MathJax.startup.extendHandler((t=>Z(t)))})();